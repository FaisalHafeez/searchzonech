"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.DEFAULT_STATE = void 0;

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _URLManager = _interopRequireDefault(require("./URLManager"));

var _RequestSequencer = _interopRequireDefault(require("./RequestSequencer"));

var _DebounceManager = _interopRequireDefault(require("./DebounceManager"));

var actions = _interopRequireWildcard(require("./actions"));

var _Events = _interopRequireDefault(require("./Events"));

var _helpers = require("./helpers");

var a11y = _interopRequireWildcard(require("./A11yNotifications"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function filterSearchParameters(_ref) {
  var current = _ref.current,
      filters = _ref.filters,
      resultsPerPage = _ref.resultsPerPage,
      searchTerm = _ref.searchTerm,
      sortDirection = _ref.sortDirection,
      sortField = _ref.sortField;
  return {
    current: current,
    filters: filters,
    resultsPerPage: resultsPerPage,
    searchTerm: searchTerm,
    sortDirection: sortDirection,
    sortField: sortField
  };
}

var DEFAULT_STATE = {
  // Search Parameters -- This is state that represents the input state.
  current: 1,
  filters: [],
  resultsPerPage: 20,
  searchTerm: "",
  sortDirection: "",
  sortField: "",
  // Result State -- This state represents state that is updated automatically
  // as the result of changing input state.
  autocompletedResults: [],
  autocompletedResultsRequestId: "",
  autocompletedSuggestions: {},
  autocompletedSuggestionsRequestId: "",
  error: "",
  isLoading: false,
  facets: {},
  requestId: "",
  results: [],
  resultSearchTerm: "",
  totalPages: 0,
  totalResults: 0,
  pagingStart: 0,
  pagingEnd: 0,
  wasSearched: false,
  rawResponse: {}
};
exports.DEFAULT_STATE = DEFAULT_STATE;

function removeConditionalFacets() {
  var facets = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var conditionalFacets = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var filters = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
  return Object.entries(facets).reduce(function (acc, _ref2) {
    var _ref3 = (0, _slicedToArray2.default)(_ref2, 2),
        facetKey = _ref3[0],
        facet = _ref3[1];

    if (conditionalFacets[facetKey] && typeof conditionalFacets[facetKey] === "function" && !conditionalFacets[facetKey]({
      filters: filters
    })) {
      return acc;
    }

    acc[facetKey] = facet;
    return acc;
  }, {});
}
/*
 * The Driver is a framework agnostic search state manager that is capable
 * syncing state to the url.
 */


var SearchDriver = /*#__PURE__*/function () {
  function SearchDriver(_ref4) {
    var _this = this;

    var apiConnector = _ref4.apiConnector,
        _ref4$autocompleteQue = _ref4.autocompleteQuery,
        autocompleteQuery = _ref4$autocompleteQue === void 0 ? {} : _ref4$autocompleteQue,
        debug = _ref4.debug,
        initialState = _ref4.initialState,
        onSearch = _ref4.onSearch,
        onAutocomplete = _ref4.onAutocomplete,
        onResultClick = _ref4.onResultClick,
        onAutocompleteResultClick = _ref4.onAutocompleteResultClick,
        _ref4$searchQuery = _ref4.searchQuery,
        searchQuery = _ref4$searchQuery === void 0 ? {} : _ref4$searchQuery,
        _ref4$trackUrlState = _ref4.trackUrlState,
        trackUrlState = _ref4$trackUrlState === void 0 ? true : _ref4$trackUrlState,
        _ref4$urlPushDebounce = _ref4.urlPushDebounceLength,
        urlPushDebounceLength = _ref4$urlPushDebounce === void 0 ? 500 : _ref4$urlPushDebounce,
        _ref4$hasA11yNotifica = _ref4.hasA11yNotifications,
        hasA11yNotifications = _ref4$hasA11yNotifica === void 0 ? false : _ref4$hasA11yNotifica,
        _ref4$a11yNotificatio = _ref4.a11yNotificationMessages,
        a11yNotificationMessages = _ref4$a11yNotificatio === void 0 ? {} : _ref4$a11yNotificatio,
        _ref4$alwaysSearchOnI = _ref4.alwaysSearchOnInitialLoad,
        alwaysSearchOnInitialLoad = _ref4$alwaysSearchOnI === void 0 ? false : _ref4$alwaysSearchOnI;
    (0, _classCallCheck2.default)(this, SearchDriver);
    (0, _defineProperty2.default)(this, "state", DEFAULT_STATE);
    (0, _defineProperty2.default)(this, "_updateAutocomplete", function (searchTerm) {
      var _ref5 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
          autocompleteResults = _ref5.autocompleteResults,
          autocompleteSuggestions = _ref5.autocompleteSuggestions;

      var requestId = _this.autocompleteRequestSequencer.next();

      var queryConfig = _objectSpread(_objectSpread({}, autocompleteResults && {
        results: _this.autocompleteQuery.results || {}
      }), autocompleteSuggestions && {
        suggestions: _this.autocompleteQuery.suggestions || {}
      });

      return _this.events.autocomplete({
        searchTerm: searchTerm
      }, queryConfig).then(function (autocompleted) {
        if (_this.autocompleteRequestSequencer.isOldRequest(requestId)) return;

        _this.autocompleteRequestSequencer.completed(requestId);

        _this._setState(autocompleted);
      });
    });
    (0, _defineProperty2.default)(this, "_updateSearchResults", function (searchParameters) {
      var _ref6 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
          _ref6$skipPushToUrl = _ref6.skipPushToUrl,
          skipPushToUrl = _ref6$skipPushToUrl === void 0 ? false : _ref6$skipPushToUrl,
          _ref6$replaceUrl = _ref6.replaceUrl,
          replaceUrl = _ref6$replaceUrl === void 0 ? false : _ref6$replaceUrl;

      var _this$state$searchPar = _objectSpread(_objectSpread({}, _this.state), searchParameters),
          current = _this$state$searchPar.current,
          filters = _this$state$searchPar.filters,
          resultsPerPage = _this$state$searchPar.resultsPerPage,
          searchTerm = _this$state$searchPar.searchTerm,
          sortDirection = _this$state$searchPar.sortDirection,
          sortField = _this$state$searchPar.sortField; // State updates should always be applied in the order that they are made. This function, _updateSearchResults,
      // makes state updates.
      // In the case where a call to "_updateSearchResults" was made and delayed for X amount of time using
      // `debounceManager.runWithDebounce`, and a subsequent call is made _updateSearchResults before that delay ends, we
      // want to make sure that outstanding call to "_updateSearchResults" is cancelled, as it would apply state updates
      // out of order.


      _this.debounceManager.cancelByName("_updateSearchResults");

      _this._setState({
        current: current,
        error: "",
        filters: filters,
        resultsPerPage: resultsPerPage,
        searchTerm: searchTerm,
        sortDirection: sortDirection,
        sortField: sortField
      });

      _this._makeSearchRequest({
        skipPushToUrl: skipPushToUrl,
        replaceUrl: replaceUrl
      });
    });
    (0, _defineProperty2.default)(this, "_makeSearchRequest", _DebounceManager.default.debounce(0, function (_ref7) {
      var skipPushToUrl = _ref7.skipPushToUrl,
          replaceUrl = _ref7.replaceUrl;
      var _this$state = _this.state,
          current = _this$state.current,
          filters = _this$state.filters,
          resultsPerPage = _this$state.resultsPerPage,
          searchTerm = _this$state.searchTerm,
          sortDirection = _this$state.sortDirection,
          sortField = _this$state.sortField;

      _this._setState({
        isLoading: true
      });

      var requestId = _this.searchRequestSequencer.next();

      var _this$searchQuery = _this.searchQuery,
          searchQueryFilters = _this$searchQuery.filters,
          conditionalFacets = _this$searchQuery.conditionalFacets,
          restOfSearchQuery = (0, _objectWithoutProperties2.default)(_this$searchQuery, ["filters", "conditionalFacets"]);

      var queryConfig = _objectSpread(_objectSpread({}, restOfSearchQuery), {}, {
        facets: removeConditionalFacets(_this.searchQuery.facets, conditionalFacets, filters)
      });

      var requestState = _objectSpread(_objectSpread({}, filterSearchParameters(_this.state)), {}, {
        filters: (0, _helpers.mergeFilters)(filters, _this.searchQuery.filters)
      });

      return _this.events.search(requestState, queryConfig).then(function (resultState) {
        if (_this.searchRequestSequencer.isOldRequest(requestId)) return;

        _this.searchRequestSequencer.completed(requestId); // Results paging start & end


        var totalResults = resultState.totalResults;
        var start = totalResults === 0 ? 0 : (current - 1) * resultsPerPage + 1;
        var end = totalResults <= start + resultsPerPage ? totalResults : start + resultsPerPage - 1;

        _this._setState(_objectSpread(_objectSpread({
          isLoading: false,
          resultSearchTerm: searchTerm,
          pagingStart: start,
          pagingEnd: end
        }, resultState), {}, {
          wasSearched: true
        }));

        if (_this.hasA11yNotifications) {
          var messageArgs = {
            start: start,
            end: end,
            totalResults: totalResults,
            searchTerm: searchTerm
          };

          _this.actions.a11yNotify("searchResults", messageArgs);
        }

        if (!skipPushToUrl && _this.trackUrlState) {
          // We debounce here so that we don't get a lot of intermediary
          // URL state if someone is updating a UI really fast, like typing
          // in a live search box for instance.
          _this.debounceManager.runWithDebounce(_this.urlPushDebounceLength, "pushStateToURL", _this.URLManager.pushStateToURL.bind(_this.URLManager), {
            current: current,
            filters: filters,
            resultsPerPage: resultsPerPage,
            searchTerm: searchTerm,
            sortDirection: sortDirection,
            sortField: sortField
          }, {
            replaceUrl: replaceUrl
          });
        }
      }, function (error) {
        _this._setState({
          error: "An unexpected error occurred: ".concat(error.message)
        });
      });
    }));
    this.actions = Object.entries(actions).reduce(function (acc, _ref8) {
      var _ref9 = (0, _slicedToArray2.default)(_ref8, 2),
          actionName = _ref9[0],
          action = _ref9[1];

      return _objectSpread(_objectSpread({}, acc), {}, (0, _defineProperty2.default)({}, actionName, action.bind(_this)));
    }, {});
    Object.assign(this, this.actions);
    this.events = new _Events.default({
      apiConnector: apiConnector,
      onSearch: onSearch,
      onAutocomplete: onAutocomplete,
      onResultClick: onResultClick,
      onAutocompleteResultClick: onAutocompleteResultClick
    });
    this.debug = debug;

    if (this.debug) {
      console.warn("Search UI Debugging is enabled. This should be turned off in production deployments.");
      window.searchUI = this;
    }

    this.autocompleteRequestSequencer = new _RequestSequencer.default();
    this.searchRequestSequencer = new _RequestSequencer.default();
    this.debounceManager = new _DebounceManager.default();
    this.autocompleteQuery = autocompleteQuery;
    this.searchQuery = searchQuery;
    this.subscriptions = [];
    this.trackUrlState = trackUrlState;
    this.urlPushDebounceLength = urlPushDebounceLength;
    this.alwaysSearchOnInitialLoad = alwaysSearchOnInitialLoad;
    var urlState;

    if (trackUrlState) {
      this.URLManager = new _URLManager.default();
      urlState = this.URLManager.getStateFromURL();
      this.URLManager.onURLStateChange(function (urlState) {
        _this._updateSearchResults(_objectSpread(_objectSpread({}, DEFAULT_STATE), urlState), {
          skipPushToUrl: true
        });
      });
    } else {
      urlState = {};
    } // Manage screen reader accessible notifications


    this.hasA11yNotifications = hasA11yNotifications;
    if (this.hasA11yNotifications) a11y.getLiveRegion();
    this.a11yNotificationMessages = _objectSpread(_objectSpread({}, a11y.defaultMessages), a11yNotificationMessages); // Remember the state this application is initialized into, so that we can
    // reset to it later.

    this.startingState = _objectSpread(_objectSpread({}, this.state), initialState); // We filter these here to disallow anything other than valid search
    // parameters to be passed in initial state, or url state. `results`, etc,
    // should not be allowed to be passed in, that should be generated based on
    // the results of the query

    var _searchParameters = filterSearchParameters(_objectSpread(_objectSpread({}, this.startingState), urlState)); // Initialize the state without calling _setState, because we don't
    // want to trigger an update callback, we're just initializing the state
    // to the correct default values for the initial UI render


    this.state = _objectSpread(_objectSpread({}, this.state), _searchParameters); // We'll trigger an initial search if initial parameters contain
    // a search term or filters, or if alwaysSearchOnInitialLoad is set.
    // Otherwise, we'll just save their selections in state as initial values.

    if (_searchParameters.searchTerm || _searchParameters.filters.length > 0 || this.alwaysSearchOnInitialLoad) {
      this._updateSearchResults(_searchParameters, {
        replaceUrl: true
      });
    }
  }
  /**
   * This method is used to update state and trigger a new autocomplete search.
   *
   * @param {string} searchTerm
   * @param {Object=} Object
   * @param {boolean|Object} options.autocompleteResults - Should autocomplete results
   * @param {boolean|Object} options.autocompleteSuggestions - Should autocomplete suggestions
   */


  (0, _createClass2.default)(SearchDriver, [{
    key: "_setState",
    value: function _setState(newState) {
      var state = _objectSpread(_objectSpread({}, this.state), newState); // eslint-disable-next-line no-console


      if (this.debug) console.log("Search UI: State Update", newState, state);
      this.state = state;
      this.subscriptions.forEach(function (subscription) {
        return subscription(state);
      });
    }
    /**
     * Dynamically update the searchQuery configuration in this driver.
     * This will issue a new query after being updated.
     *
     * @param Object searchQuery
     */

  }, {
    key: "setSearchQuery",
    value: function setSearchQuery(searchQuery) {
      this.searchQuery = searchQuery;

      this._updateSearchResults();
    }
    /**
     * @param Object autocompleteQuery
     */

  }, {
    key: "setAutocompleteQuery",
    value: function setAutocompleteQuery(autocompleteQuery) {
      this.autocompleteQuery = autocompleteQuery;
    }
    /**
     * Any time state is updated in this Driver, the provided callback
     * will be executed with the updated state.
     *
     * @param onStateChange Function
     */

  }, {
    key: "subscribeToStateChanges",
    value: function subscribeToStateChanges(onStateChange) {
      this.subscriptions.push(onStateChange);
    }
    /**
     * @param onStateChange Function
     */

  }, {
    key: "unsubscribeToStateChanges",
    value: function unsubscribeToStateChanges(onStateChange) {
      this.subscriptions = this.subscriptions.filter(function (sub) {
        return sub !== onStateChange;
      });
    }
    /**
     * Remove all listeners
     */

  }, {
    key: "tearDown",
    value: function tearDown() {
      this.subscriptions = [];
      this.URLManager && this.URLManager.tearDown();
    }
    /**
     * Retrieves all available acitons
     *
     * @returns Object All actions
     */

  }, {
    key: "getActions",
    value: function getActions() {
      return this.actions;
    }
    /**
     * Retrieve current state. Typically used on app initialization. Subsequent
     * state updates should come through subscription.
     *
     * @returns Object Current state
     */

  }, {
    key: "getState",
    value: function getState() {
      // We return a copy of state here, because we want to ensure the state
      // inside of this object remains immutable.
      return _objectSpread({}, this.state);
    }
  }]);
  return SearchDriver;
}();

exports.default = SearchDriver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TZWFyY2hEcml2ZXIuanMiXSwibmFtZXMiOlsiZmlsdGVyU2VhcmNoUGFyYW1ldGVycyIsImN1cnJlbnQiLCJmaWx0ZXJzIiwicmVzdWx0c1BlclBhZ2UiLCJzZWFyY2hUZXJtIiwic29ydERpcmVjdGlvbiIsInNvcnRGaWVsZCIsIkRFRkFVTFRfU1RBVEUiLCJhdXRvY29tcGxldGVkUmVzdWx0cyIsImF1dG9jb21wbGV0ZWRSZXN1bHRzUmVxdWVzdElkIiwiYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zIiwiYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zUmVxdWVzdElkIiwiZXJyb3IiLCJpc0xvYWRpbmciLCJmYWNldHMiLCJyZXF1ZXN0SWQiLCJyZXN1bHRzIiwicmVzdWx0U2VhcmNoVGVybSIsInRvdGFsUGFnZXMiLCJ0b3RhbFJlc3VsdHMiLCJwYWdpbmdTdGFydCIsInBhZ2luZ0VuZCIsIndhc1NlYXJjaGVkIiwicmF3UmVzcG9uc2UiLCJyZW1vdmVDb25kaXRpb25hbEZhY2V0cyIsImNvbmRpdGlvbmFsRmFjZXRzIiwiT2JqZWN0IiwiZW50cmllcyIsInJlZHVjZSIsImFjYyIsImZhY2V0S2V5IiwiZmFjZXQiLCJTZWFyY2hEcml2ZXIiLCJhcGlDb25uZWN0b3IiLCJhdXRvY29tcGxldGVRdWVyeSIsImRlYnVnIiwiaW5pdGlhbFN0YXRlIiwib25TZWFyY2giLCJvbkF1dG9jb21wbGV0ZSIsIm9uUmVzdWx0Q2xpY2siLCJvbkF1dG9jb21wbGV0ZVJlc3VsdENsaWNrIiwic2VhcmNoUXVlcnkiLCJ0cmFja1VybFN0YXRlIiwidXJsUHVzaERlYm91bmNlTGVuZ3RoIiwiaGFzQTExeU5vdGlmaWNhdGlvbnMiLCJhMTF5Tm90aWZpY2F0aW9uTWVzc2FnZXMiLCJhbHdheXNTZWFyY2hPbkluaXRpYWxMb2FkIiwiYXV0b2NvbXBsZXRlUmVzdWx0cyIsImF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zIiwiYXV0b2NvbXBsZXRlUmVxdWVzdFNlcXVlbmNlciIsIm5leHQiLCJxdWVyeUNvbmZpZyIsInN1Z2dlc3Rpb25zIiwiZXZlbnRzIiwiYXV0b2NvbXBsZXRlIiwidGhlbiIsImF1dG9jb21wbGV0ZWQiLCJpc09sZFJlcXVlc3QiLCJjb21wbGV0ZWQiLCJfc2V0U3RhdGUiLCJzZWFyY2hQYXJhbWV0ZXJzIiwic2tpcFB1c2hUb1VybCIsInJlcGxhY2VVcmwiLCJzdGF0ZSIsImRlYm91bmNlTWFuYWdlciIsImNhbmNlbEJ5TmFtZSIsIl9tYWtlU2VhcmNoUmVxdWVzdCIsIkRlYm91bmNlTWFuYWdlciIsImRlYm91bmNlIiwic2VhcmNoUmVxdWVzdFNlcXVlbmNlciIsInNlYXJjaFF1ZXJ5RmlsdGVycyIsInJlc3RPZlNlYXJjaFF1ZXJ5IiwicmVxdWVzdFN0YXRlIiwic2VhcmNoIiwicmVzdWx0U3RhdGUiLCJzdGFydCIsImVuZCIsIm1lc3NhZ2VBcmdzIiwiYWN0aW9ucyIsImExMXlOb3RpZnkiLCJydW5XaXRoRGVib3VuY2UiLCJVUkxNYW5hZ2VyIiwicHVzaFN0YXRlVG9VUkwiLCJiaW5kIiwibWVzc2FnZSIsImFjdGlvbk5hbWUiLCJhY3Rpb24iLCJhc3NpZ24iLCJFdmVudHMiLCJjb25zb2xlIiwid2FybiIsIndpbmRvdyIsInNlYXJjaFVJIiwiUmVxdWVzdFNlcXVlbmNlciIsInN1YnNjcmlwdGlvbnMiLCJ1cmxTdGF0ZSIsImdldFN0YXRlRnJvbVVSTCIsIm9uVVJMU3RhdGVDaGFuZ2UiLCJfdXBkYXRlU2VhcmNoUmVzdWx0cyIsImExMXkiLCJnZXRMaXZlUmVnaW9uIiwiZGVmYXVsdE1lc3NhZ2VzIiwic3RhcnRpbmdTdGF0ZSIsImxlbmd0aCIsIm5ld1N0YXRlIiwibG9nIiwiZm9yRWFjaCIsInN1YnNjcmlwdGlvbiIsIm9uU3RhdGVDaGFuZ2UiLCJwdXNoIiwiZmlsdGVyIiwic3ViIiwidGVhckRvd24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUVBOzs7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QUFhQSxLQUFiO0FBQ0EsV0FBSytCLGFBQUwsQ0FBbUJZLE9BQW5CLENBQTJCLFVBQUFDLFlBQVk7QUFBQSxlQUFJQSxZQUFZLENBQUM1QyxLQUFELENBQWhCO0FBQUEsT0FBdkM7QUFDRDtBQUVEOzs7Ozs7Ozs7bUNBTWV0QixXLEVBQWE7QUFDMUIsV0FBS0EsV0FBTCxHQUFtQkEsV0FBbkI7O0FBQ0EsV0FBS3lELG9CQUFMO0FBQ0Q7QUFFRDs7Ozs7O3lDQUdxQmhFLGlCLEVBQW1CO0FBQ3RDLFdBQUtBLGlCQUFMLEdBQXlCQSxpQkFBekI7QUFDRDtBQUVEOzs7Ozs7Ozs7NENBTXdCMEUsYSxFQUFlO0FBQ3JDLFdBQUtkLGFBQUwsQ0FBbUJlLElBQW5CLENBQXdCRCxhQUF4QjtBQUNEO0FBRUQ7Ozs7Ozs4Q0FHMEJBLGEsRUFBZTtBQUN2QyxXQUFLZCxhQUFMLEdBQXFCLEtBQUtBLGFBQUwsQ0FBbUJnQixNQUFuQixDQUNuQixVQUFBQyxHQUFHO0FBQUEsZUFBSUEsR0FBRyxLQUFLSCxhQUFaO0FBQUEsT0FEZ0IsQ0FBckI7QUFHRDtBQUVEOzs7Ozs7K0JBR1c7QUFDVCxXQUFLZCxhQUFMLEdBQXFCLEVBQXJCO0FBQ0EsV0FBS2IsVUFBTCxJQUFtQixLQUFLQSxVQUFMLENBQWdCK0IsUUFBaEIsRUFBbkI7QUFDRDtBQUVEOzs7Ozs7OztpQ0FLYTtBQUNYLGFBQU8sS0FBS2xDLE9BQVo7QUFDRDtBQUVEOzs7Ozs7Ozs7K0JBTVc7QUFDVDtBQUNBO0FBQ0EsK0JBQVksS0FBS2YsS0FBakI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBVUkxNYW5hZ2VyIGZyb20gXCIuL1VSTE1hbmFnZXJcIjtcblxuaW1wb3J0IFJlcXVlc3RTZXF1ZW5jZXIgZnJvbSBcIi4vUmVxdWVzdFNlcXVlbmNlclwiO1xuaW1wb3J0IERlYm91bmNlTWFuYWdlciBmcm9tIFwiLi9EZWJvdW5jZU1hbmFnZXJcIjtcblxuaW1wb3J0ICogYXMgYWN0aW9ucyBmcm9tIFwiLi9hY3Rpb25zXCI7XG5pbXBvcnQgRXZlbnRzIGZyb20gXCIuL0V2ZW50c1wiO1xuaW1wb3J0IHsgbWVyZ2VGaWx0ZXJzIH0gZnJvbSBcIi4vaGVscGVyc1wiO1xuXG5pbXBvcnQgKiBhcyBhMTF5IGZyb20gXCIuL0ExMXlOb3RpZmljYXRpb25zXCI7XG5cbmZ1bmN0aW9uIGZpbHRlclNlYXJjaFBhcmFtZXRlcnMoe1xuICBjdXJyZW50LFxuICBmaWx0ZXJzLFxuICByZXN1bHRzUGVyUGFnZSxcbiAgc2VhcmNoVGVybSxcbiAgc29ydERpcmVjdGlvbixcbiAgc29ydEZpZWxkXG59KSB7XG4gIHJldHVybiB7XG4gICAgY3VycmVudCxcbiAgICBmaWx0ZXJzLFxuICAgIHJlc3VsdHNQZXJQYWdlLFxuICAgIHNlYXJjaFRlcm0sXG4gICAgc29ydERpcmVjdGlvbixcbiAgICBzb3J0RmllbGRcbiAgfTtcbn1cblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfU1RBVEUgPSB7XG4gIC8vIFNlYXJjaCBQYXJhbWV0ZXJzIC0tIFRoaXMgaXMgc3RhdGUgdGhhdCByZXByZXNlbnRzIHRoZSBpbnB1dCBzdGF0ZS5cbiAgY3VycmVudDogMSxcbiAgZmlsdGVyczogW10sXG4gIHJlc3VsdHNQZXJQYWdlOiAyMCxcbiAgc2VhcmNoVGVybTogXCJcIixcbiAgc29ydERpcmVjdGlvbjogXCJcIixcbiAgc29ydEZpZWxkOiBcIlwiLFxuICAvLyBSZXN1bHQgU3RhdGUgLS0gVGhpcyBzdGF0ZSByZXByZXNlbnRzIHN0YXRlIHRoYXQgaXMgdXBkYXRlZCBhdXRvbWF0aWNhbGx5XG4gIC8vIGFzIHRoZSByZXN1bHQgb2YgY2hhbmdpbmcgaW5wdXQgc3RhdGUuXG4gIGF1dG9jb21wbGV0ZWRSZXN1bHRzOiBbXSxcbiAgYXV0b2NvbXBsZXRlZFJlc3VsdHNSZXF1ZXN0SWQ6IFwiXCIsXG4gIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uczoge30sXG4gIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uc1JlcXVlc3RJZDogXCJcIixcbiAgZXJyb3I6IFwiXCIsXG4gIGlzTG9hZGluZzogZmFsc2UsXG4gIGZhY2V0czoge30sXG4gIHJlcXVlc3RJZDogXCJcIixcbiAgcmVzdWx0czogW10sXG4gIHJlc3VsdFNlYXJjaFRlcm06IFwiXCIsXG4gIHRvdGFsUGFnZXM6IDAsXG4gIHRvdGFsUmVzdWx0czogMCxcbiAgcGFnaW5nU3RhcnQ6IDAsXG4gIHBhZ2luZ0VuZDogMCxcbiAgd2FzU2VhcmNoZWQ6IGZhbHNlLFxuICByYXdSZXNwb25zZToge31cbn07XG5cbmZ1bmN0aW9uIHJlbW92ZUNvbmRpdGlvbmFsRmFjZXRzKFxuICBmYWNldHMgPSB7fSxcbiAgY29uZGl0aW9uYWxGYWNldHMgPSB7fSxcbiAgZmlsdGVycyA9IFtdXG4pIHtcbiAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKGZhY2V0cykucmVkdWNlKChhY2MsIFtmYWNldEtleSwgZmFjZXRdKSA9PiB7XG4gICAgaWYgKFxuICAgICAgY29uZGl0aW9uYWxGYWNldHNbZmFjZXRLZXldICYmXG4gICAgICB0eXBlb2YgY29uZGl0aW9uYWxGYWNldHNbZmFjZXRLZXldID09PSBcImZ1bmN0aW9uXCIgJiZcbiAgICAgICFjb25kaXRpb25hbEZhY2V0c1tmYWNldEtleV0oeyBmaWx0ZXJzIH0pXG4gICAgKSB7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH1cblxuICAgIGFjY1tmYWNldEtleV0gPSBmYWNldDtcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG59XG5cbi8qXG4gKiBUaGUgRHJpdmVyIGlzIGEgZnJhbWV3b3JrIGFnbm9zdGljIHNlYXJjaCBzdGF0ZSBtYW5hZ2VyIHRoYXQgaXMgY2FwYWJsZVxuICogc3luY2luZyBzdGF0ZSB0byB0aGUgdXJsLlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZWFyY2hEcml2ZXIge1xuICBzdGF0ZSA9IERFRkFVTFRfU1RBVEU7XG5cbiAgY29uc3RydWN0b3Ioe1xuICAgIGFwaUNvbm5lY3RvcixcbiAgICBhdXRvY29tcGxldGVRdWVyeSA9IHt9LFxuICAgIGRlYnVnLFxuICAgIGluaXRpYWxTdGF0ZSxcbiAgICBvblNlYXJjaCxcbiAgICBvbkF1dG9jb21wbGV0ZSxcbiAgICBvblJlc3VsdENsaWNrLFxuICAgIG9uQXV0b2NvbXBsZXRlUmVzdWx0Q2xpY2ssXG4gICAgc2VhcmNoUXVlcnkgPSB7fSxcbiAgICB0cmFja1VybFN0YXRlID0gdHJ1ZSxcbiAgICB1cmxQdXNoRGVib3VuY2VMZW5ndGggPSA1MDAsXG4gICAgaGFzQTExeU5vdGlmaWNhdGlvbnMgPSBmYWxzZSxcbiAgICBhMTF5Tm90aWZpY2F0aW9uTWVzc2FnZXMgPSB7fSxcbiAgICBhbHdheXNTZWFyY2hPbkluaXRpYWxMb2FkID0gZmFsc2VcbiAgfSkge1xuICAgIHRoaXMuYWN0aW9ucyA9IE9iamVjdC5lbnRyaWVzKGFjdGlvbnMpLnJlZHVjZShcbiAgICAgIChhY2MsIFthY3Rpb25OYW1lLCBhY3Rpb25dKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4uYWNjLFxuICAgICAgICAgIFthY3Rpb25OYW1lXTogYWN0aW9uLmJpbmQodGhpcylcbiAgICAgICAgfTtcbiAgICAgIH0sXG4gICAgICB7fVxuICAgICk7XG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLCB0aGlzLmFjdGlvbnMpO1xuXG4gICAgdGhpcy5ldmVudHMgPSBuZXcgRXZlbnRzKHtcbiAgICAgIGFwaUNvbm5lY3RvcixcbiAgICAgIG9uU2VhcmNoLFxuICAgICAgb25BdXRvY29tcGxldGUsXG4gICAgICBvblJlc3VsdENsaWNrLFxuICAgICAgb25BdXRvY29tcGxldGVSZXN1bHRDbGlja1xuICAgIH0pO1xuXG4gICAgdGhpcy5kZWJ1ZyA9IGRlYnVnO1xuICAgIGlmICh0aGlzLmRlYnVnKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIFwiU2VhcmNoIFVJIERlYnVnZ2luZyBpcyBlbmFibGVkLiBUaGlzIHNob3VsZCBiZSB0dXJuZWQgb2ZmIGluIHByb2R1Y3Rpb24gZGVwbG95bWVudHMuXCJcbiAgICAgICk7XG4gICAgICB3aW5kb3cuc2VhcmNoVUkgPSB0aGlzO1xuICAgIH1cbiAgICB0aGlzLmF1dG9jb21wbGV0ZVJlcXVlc3RTZXF1ZW5jZXIgPSBuZXcgUmVxdWVzdFNlcXVlbmNlcigpO1xuICAgIHRoaXMuc2VhcmNoUmVxdWVzdFNlcXVlbmNlciA9IG5ldyBSZXF1ZXN0U2VxdWVuY2VyKCk7XG4gICAgdGhpcy5kZWJvdW5jZU1hbmFnZXIgPSBuZXcgRGVib3VuY2VNYW5hZ2VyKCk7XG4gICAgdGhpcy5hdXRvY29tcGxldGVRdWVyeSA9IGF1dG9jb21wbGV0ZVF1ZXJ5O1xuICAgIHRoaXMuc2VhcmNoUXVlcnkgPSBzZWFyY2hRdWVyeTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXTtcbiAgICB0aGlzLnRyYWNrVXJsU3RhdGUgPSB0cmFja1VybFN0YXRlO1xuICAgIHRoaXMudXJsUHVzaERlYm91bmNlTGVuZ3RoID0gdXJsUHVzaERlYm91bmNlTGVuZ3RoO1xuICAgIHRoaXMuYWx3YXlzU2VhcmNoT25Jbml0aWFsTG9hZCA9IGFsd2F5c1NlYXJjaE9uSW5pdGlhbExvYWQ7XG5cbiAgICBsZXQgdXJsU3RhdGU7XG4gICAgaWYgKHRyYWNrVXJsU3RhdGUpIHtcbiAgICAgIHRoaXMuVVJMTWFuYWdlciA9IG5ldyBVUkxNYW5hZ2VyKCk7XG4gICAgICB1cmxTdGF0ZSA9IHRoaXMuVVJMTWFuYWdlci5nZXRTdGF0ZUZyb21VUkwoKTtcbiAgICAgIHRoaXMuVVJMTWFuYWdlci5vblVSTFN0YXRlQ2hhbmdlKHVybFN0YXRlID0+IHtcbiAgICAgICAgdGhpcy5fdXBkYXRlU2VhcmNoUmVzdWx0cyhcbiAgICAgICAgICB7IC4uLkRFRkFVTFRfU1RBVEUsIC4uLnVybFN0YXRlIH0sXG4gICAgICAgICAgeyBza2lwUHVzaFRvVXJsOiB0cnVlIH1cbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB1cmxTdGF0ZSA9IHt9O1xuICAgIH1cblxuICAgIC8vIE1hbmFnZSBzY3JlZW4gcmVhZGVyIGFjY2Vzc2libGUgbm90aWZpY2F0aW9uc1xuICAgIHRoaXMuaGFzQTExeU5vdGlmaWNhdGlvbnMgPSBoYXNBMTF5Tm90aWZpY2F0aW9ucztcbiAgICBpZiAodGhpcy5oYXNBMTF5Tm90aWZpY2F0aW9ucykgYTExeS5nZXRMaXZlUmVnaW9uKCk7XG5cbiAgICB0aGlzLmExMXlOb3RpZmljYXRpb25NZXNzYWdlcyA9IHtcbiAgICAgIC4uLmExMXkuZGVmYXVsdE1lc3NhZ2VzLFxuICAgICAgLi4uYTExeU5vdGlmaWNhdGlvbk1lc3NhZ2VzXG4gICAgfTtcblxuICAgIC8vIFJlbWVtYmVyIHRoZSBzdGF0ZSB0aGlzIGFwcGxpY2F0aW9uIGlzIGluaXRpYWxpemVkIGludG8sIHNvIHRoYXQgd2UgY2FuXG4gICAgLy8gcmVzZXQgdG8gaXQgbGF0ZXIuXG4gICAgdGhpcy5zdGFydGluZ1N0YXRlID0ge1xuICAgICAgLi4udGhpcy5zdGF0ZSxcbiAgICAgIC4uLmluaXRpYWxTdGF0ZVxuICAgIH07XG5cbiAgICAvLyBXZSBmaWx0ZXIgdGhlc2UgaGVyZSB0byBkaXNhbGxvdyBhbnl0aGluZyBvdGhlciB0aGFuIHZhbGlkIHNlYXJjaFxuICAgIC8vIHBhcmFtZXRlcnMgdG8gYmUgcGFzc2VkIGluIGluaXRpYWwgc3RhdGUsIG9yIHVybCBzdGF0ZS4gYHJlc3VsdHNgLCBldGMsXG4gICAgLy8gc2hvdWxkIG5vdCBiZSBhbGxvd2VkIHRvIGJlIHBhc3NlZCBpbiwgdGhhdCBzaG91bGQgYmUgZ2VuZXJhdGVkIGJhc2VkIG9uXG4gICAgLy8gdGhlIHJlc3VsdHMgb2YgdGhlIHF1ZXJ5XG4gICAgY29uc3Qgc2VhcmNoUGFyYW1ldGVycyA9IGZpbHRlclNlYXJjaFBhcmFtZXRlcnMoe1xuICAgICAgLi4udGhpcy5zdGFydGluZ1N0YXRlLFxuICAgICAgLi4udXJsU3RhdGVcbiAgICB9KTtcblxuICAgIC8vIEluaXRpYWxpemUgdGhlIHN0YXRlIHdpdGhvdXQgY2FsbGluZyBfc2V0U3RhdGUsIGJlY2F1c2Ugd2UgZG9uJ3RcbiAgICAvLyB3YW50IHRvIHRyaWdnZXIgYW4gdXBkYXRlIGNhbGxiYWNrLCB3ZSdyZSBqdXN0IGluaXRpYWxpemluZyB0aGUgc3RhdGVcbiAgICAvLyB0byB0aGUgY29ycmVjdCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhlIGluaXRpYWwgVUkgcmVuZGVyXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIC4uLnRoaXMuc3RhdGUsXG4gICAgICAuLi5zZWFyY2hQYXJhbWV0ZXJzXG4gICAgfTtcblxuICAgIC8vIFdlJ2xsIHRyaWdnZXIgYW4gaW5pdGlhbCBzZWFyY2ggaWYgaW5pdGlhbCBwYXJhbWV0ZXJzIGNvbnRhaW5cbiAgICAvLyBhIHNlYXJjaCB0ZXJtIG9yIGZpbHRlcnMsIG9yIGlmIGFsd2F5c1NlYXJjaE9uSW5pdGlhbExvYWQgaXMgc2V0LlxuICAgIC8vIE90aGVyd2lzZSwgd2UnbGwganVzdCBzYXZlIHRoZWlyIHNlbGVjdGlvbnMgaW4gc3RhdGUgYXMgaW5pdGlhbCB2YWx1ZXMuXG4gICAgaWYgKFxuICAgICAgc2VhcmNoUGFyYW1ldGVycy5zZWFyY2hUZXJtIHx8XG4gICAgICBzZWFyY2hQYXJhbWV0ZXJzLmZpbHRlcnMubGVuZ3RoID4gMCB8fFxuICAgICAgdGhpcy5hbHdheXNTZWFyY2hPbkluaXRpYWxMb2FkXG4gICAgKSB7XG4gICAgICB0aGlzLl91cGRhdGVTZWFyY2hSZXN1bHRzKHNlYXJjaFBhcmFtZXRlcnMsIHsgcmVwbGFjZVVybDogdHJ1ZSB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgaXMgdXNlZCB0byB1cGRhdGUgc3RhdGUgYW5kIHRyaWdnZXIgYSBuZXcgYXV0b2NvbXBsZXRlIHNlYXJjaC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlYXJjaFRlcm1cbiAgICogQHBhcmFtIHtPYmplY3Q9fSBPYmplY3RcbiAgICogQHBhcmFtIHtib29sZWFufE9iamVjdH0gb3B0aW9ucy5hdXRvY29tcGxldGVSZXN1bHRzIC0gU2hvdWxkIGF1dG9jb21wbGV0ZSByZXN1bHRzXG4gICAqIEBwYXJhbSB7Ym9vbGVhbnxPYmplY3R9IG9wdGlvbnMuYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMgLSBTaG91bGQgYXV0b2NvbXBsZXRlIHN1Z2dlc3Rpb25zXG4gICAqL1xuICBfdXBkYXRlQXV0b2NvbXBsZXRlID0gKFxuICAgIHNlYXJjaFRlcm0sXG4gICAgeyBhdXRvY29tcGxldGVSZXN1bHRzLCBhdXRvY29tcGxldGVTdWdnZXN0aW9ucyB9ID0ge31cbiAgKSA9PiB7XG4gICAgY29uc3QgcmVxdWVzdElkID0gdGhpcy5hdXRvY29tcGxldGVSZXF1ZXN0U2VxdWVuY2VyLm5leHQoKTtcblxuICAgIGNvbnN0IHF1ZXJ5Q29uZmlnID0ge1xuICAgICAgLi4uKGF1dG9jb21wbGV0ZVJlc3VsdHMgJiYge1xuICAgICAgICByZXN1bHRzOiB0aGlzLmF1dG9jb21wbGV0ZVF1ZXJ5LnJlc3VsdHMgfHwge31cbiAgICAgIH0pLFxuICAgICAgLi4uKGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zICYmIHtcbiAgICAgICAgc3VnZ2VzdGlvbnM6IHRoaXMuYXV0b2NvbXBsZXRlUXVlcnkuc3VnZ2VzdGlvbnMgfHwge31cbiAgICAgIH0pXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLmV2ZW50c1xuICAgICAgLmF1dG9jb21wbGV0ZSh7IHNlYXJjaFRlcm0gfSwgcXVlcnlDb25maWcpXG4gICAgICAudGhlbihhdXRvY29tcGxldGVkID0+IHtcbiAgICAgICAgaWYgKHRoaXMuYXV0b2NvbXBsZXRlUmVxdWVzdFNlcXVlbmNlci5pc09sZFJlcXVlc3QocmVxdWVzdElkKSkgcmV0dXJuO1xuICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZVJlcXVlc3RTZXF1ZW5jZXIuY29tcGxldGVkKHJlcXVlc3RJZCk7XG5cbiAgICAgICAgdGhpcy5fc2V0U3RhdGUoYXV0b2NvbXBsZXRlZCk7XG4gICAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgaXMgdXNlZCB0byB1cGRhdGUgc3RhdGUgYW5kIHRyaWdnZXIgYSBuZXcgc2VhcmNoLlxuICAgKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBSZXF1ZXN0U3RhdGVcbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IGN1cnJlbnRcbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IHJlc3VsdHNQZXJQYWdlXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzZWFyY2hUZXJtXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzb3J0RGlyZWN0aW9uXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzb3J0RmllbGRcbiAgICpcbiAgICogQHBhcmFtIHtSZXF1ZXN0U3RhdGV9IHNlYXJjaFBhcmFtZXRlcnMgLSBSZXF1ZXN0U3RhdGVcbiAgICogQHBhcmFtIHtPYmplY3Q9fSBPYmplY3RcbiAgICogQHBhcmFtIHtib29sZWFufSBvcHRpb25zLnNraXBQdXNoVG9VcmwgLSBTa2lwIHB1c2hpbmcgdGhlIHVwZGF0ZWQgdG8gdGhlIFVSTFxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IG9wdGlvbnMucmVwbGFjZVVybCAtIFdoZW4gcHVzaGluZyBzdGF0ZSB0byB0aGUgVVJMLCB1c2UgaGlzdG9yeSAncmVwbGFjZSdcbiAgICogcmF0aGVyIHRoYW4gJ3B1c2gnIHRvIGF2b2lkIGFkZGluZyBhIG5ldyBoaXN0b3J5IGVudHJ5XG4gICAqL1xuICBfdXBkYXRlU2VhcmNoUmVzdWx0cyA9IChcbiAgICBzZWFyY2hQYXJhbWV0ZXJzLFxuICAgIHsgc2tpcFB1c2hUb1VybCA9IGZhbHNlLCByZXBsYWNlVXJsID0gZmFsc2UgfSA9IHt9XG4gICkgPT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIGN1cnJlbnQsXG4gICAgICBmaWx0ZXJzLFxuICAgICAgcmVzdWx0c1BlclBhZ2UsXG4gICAgICBzZWFyY2hUZXJtLFxuICAgICAgc29ydERpcmVjdGlvbixcbiAgICAgIHNvcnRGaWVsZFxuICAgIH0gPSB7XG4gICAgICAuLi50aGlzLnN0YXRlLFxuICAgICAgLi4uc2VhcmNoUGFyYW1ldGVyc1xuICAgIH07XG5cbiAgICAvLyBTdGF0ZSB1cGRhdGVzIHNob3VsZCBhbHdheXMgYmUgYXBwbGllZCBpbiB0aGUgb3JkZXIgdGhhdCB0aGV5IGFyZSBtYWRlLiBUaGlzIGZ1bmN0aW9uLCBfdXBkYXRlU2VhcmNoUmVzdWx0cyxcbiAgICAvLyBtYWtlcyBzdGF0ZSB1cGRhdGVzLlxuICAgIC8vIEluIHRoZSBjYXNlIHdoZXJlIGEgY2FsbCB0byBcIl91cGRhdGVTZWFyY2hSZXN1bHRzXCIgd2FzIG1hZGUgYW5kIGRlbGF5ZWQgZm9yIFggYW1vdW50IG9mIHRpbWUgdXNpbmdcbiAgICAvLyBgZGVib3VuY2VNYW5hZ2VyLnJ1bldpdGhEZWJvdW5jZWAsIGFuZCBhIHN1YnNlcXVlbnQgY2FsbCBpcyBtYWRlIF91cGRhdGVTZWFyY2hSZXN1bHRzIGJlZm9yZSB0aGF0IGRlbGF5IGVuZHMsIHdlXG4gICAgLy8gd2FudCB0byBtYWtlIHN1cmUgdGhhdCBvdXRzdGFuZGluZyBjYWxsIHRvIFwiX3VwZGF0ZVNlYXJjaFJlc3VsdHNcIiBpcyBjYW5jZWxsZWQsIGFzIGl0IHdvdWxkIGFwcGx5IHN0YXRlIHVwZGF0ZXNcbiAgICAvLyBvdXQgb2Ygb3JkZXIuXG4gICAgdGhpcy5kZWJvdW5jZU1hbmFnZXIuY2FuY2VsQnlOYW1lKFwiX3VwZGF0ZVNlYXJjaFJlc3VsdHNcIik7XG5cbiAgICB0aGlzLl9zZXRTdGF0ZSh7XG4gICAgICBjdXJyZW50LFxuICAgICAgZXJyb3I6IFwiXCIsXG4gICAgICBmaWx0ZXJzLFxuICAgICAgcmVzdWx0c1BlclBhZ2UsXG4gICAgICBzZWFyY2hUZXJtLFxuICAgICAgc29ydERpcmVjdGlvbixcbiAgICAgIHNvcnRGaWVsZFxuICAgIH0pO1xuXG4gICAgdGhpcy5fbWFrZVNlYXJjaFJlcXVlc3Qoe1xuICAgICAgc2tpcFB1c2hUb1VybCxcbiAgICAgIHJlcGxhY2VVcmxcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgaXMgc2VwYXJhdGVkIG91dCBmcm9tIF91cGRhdGVTZWFyY2hSZXN1bHRzIHNvIHRoYXQgaXRcbiAgICogY2FuIGJlIGRlYm91bmNlZC5cbiAgICpcbiAgICogQnkgZGVib3VuY2luZyBvdXIgQVBJIGNhbGxzLCB3ZSBjYW4gZWZmZWN0aXZlbHkgYWxsb3cgYWN0aW9uIGNoYWluaW5nLlxuICAgKlxuICAgKiBGb3IgRXg6XG4gICAqXG4gICAqIElmIGEgdXNlciBuZWVkcyB0byBtYWtlIG11bHRpcGxlIGZpbHRlciB1cGRhdGVzIGF0IG9uY2UsIHRoZXkgY291bGRcbiAgICogZG8gc28gYnkgY2FsbGluZyBhbiBhY3Rpb24gMyB0aW1lcyBpbiBhIHJvdzpcbiAgICpcbiAgICogICBhZGRGaWx0ZXIoXCJzdGF0ZXNcIiwgXCJDYWxpZm9ybmlhXCIpO1xuICAgKiAgIGFkZEZpbHRlcihcInN0YXRlc1wiLCBcIk5lYnJhc2thXCIpO1xuICAgKiAgIGFkZEZpbHRlcihcInN0YXRlc1wiLCBcIlBlbm5zeWx2YW5pYVwiKTtcbiAgICpcbiAgICogV2UgZG9uJ3Qgd2FudCB0byBtYWtlIDMgc2VwYXJhdGUgQVBJIGNhbGxzIGxpa2UgdGhhdCBpbiBxdWljayBzdWNjZXNzaW9uLFxuICAgKiBzbyB3ZSBkZWJvdW5jZSB0aGUgQVBJIGNhbGxzLlxuICAgKlxuICAgKiBBcHBsaWNhdGlvbiBzdGF0ZSB1cGRhdGVzIGFyZSBwZXJmb3JtZWQgaW4gX3VwZGF0ZVNlYXJjaFJlc3VsdHMsIGJ1dCB3ZVxuICAgKiB3YWl0IHRvIG1ha2UgdGhlIGFjdHVhbCBBUEkgY2FsbHMgdW50aWwgYWxsIGFjdGlvbnMgaGF2ZSBiZWVuIGNhbGxlZC5cbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICogQHBhcmFtIHtib29sZWFufSBvcHRpb25zLnNraXBQdXNoVG9VcmwgLSBTa2lwIHB1c2hpbmcgdGhlIHVwZGF0ZWQgdG8gdGhlIFVSTFxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IG9wdGlvbnMucmVwbGFjZVVybCAtIFdoZW4gcHVzaGluZyBzdGF0ZSB0byB0aGUgVVJMLCB1c2UgaGlzdG9yeSAncmVwbGFjZSdcbiAgICogcmF0aGVyIHRoYW4gJ3B1c2gnIHRvIGF2b2lkIGFkZGluZyBhIG5ldyBoaXN0b3J5IGVudHJ5XG4gICAqL1xuICBfbWFrZVNlYXJjaFJlcXVlc3QgPSBEZWJvdW5jZU1hbmFnZXIuZGVib3VuY2UoXG4gICAgMCxcbiAgICAoeyBza2lwUHVzaFRvVXJsLCByZXBsYWNlVXJsIH0pID0+IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgY3VycmVudCxcbiAgICAgICAgZmlsdGVycyxcbiAgICAgICAgcmVzdWx0c1BlclBhZ2UsXG4gICAgICAgIHNlYXJjaFRlcm0sXG4gICAgICAgIHNvcnREaXJlY3Rpb24sXG4gICAgICAgIHNvcnRGaWVsZFxuICAgICAgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICAgIHRoaXMuX3NldFN0YXRlKHtcbiAgICAgICAgaXNMb2FkaW5nOiB0cnVlXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVxdWVzdElkID0gdGhpcy5zZWFyY2hSZXF1ZXN0U2VxdWVuY2VyLm5leHQoKTtcblxuICAgICAgY29uc3Qge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgICAgICAgZmlsdGVyczogc2VhcmNoUXVlcnlGaWx0ZXJzLFxuICAgICAgICBjb25kaXRpb25hbEZhY2V0czogY29uZGl0aW9uYWxGYWNldHMsXG4gICAgICAgIC4uLnJlc3RPZlNlYXJjaFF1ZXJ5XG4gICAgICB9ID0gdGhpcy5zZWFyY2hRdWVyeTtcblxuICAgICAgY29uc3QgcXVlcnlDb25maWcgPSB7XG4gICAgICAgIC4uLnJlc3RPZlNlYXJjaFF1ZXJ5LFxuICAgICAgICBmYWNldHM6IHJlbW92ZUNvbmRpdGlvbmFsRmFjZXRzKFxuICAgICAgICAgIHRoaXMuc2VhcmNoUXVlcnkuZmFjZXRzLFxuICAgICAgICAgIGNvbmRpdGlvbmFsRmFjZXRzLFxuICAgICAgICAgIGZpbHRlcnNcbiAgICAgICAgKVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHJlcXVlc3RTdGF0ZSA9IHtcbiAgICAgICAgLi4uZmlsdGVyU2VhcmNoUGFyYW1ldGVycyh0aGlzLnN0YXRlKSxcbiAgICAgICAgZmlsdGVyczogbWVyZ2VGaWx0ZXJzKGZpbHRlcnMsIHRoaXMuc2VhcmNoUXVlcnkuZmlsdGVycylcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiB0aGlzLmV2ZW50cy5zZWFyY2gocmVxdWVzdFN0YXRlLCBxdWVyeUNvbmZpZykudGhlbihcbiAgICAgICAgcmVzdWx0U3RhdGUgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLnNlYXJjaFJlcXVlc3RTZXF1ZW5jZXIuaXNPbGRSZXF1ZXN0KHJlcXVlc3RJZCkpIHJldHVybjtcbiAgICAgICAgICB0aGlzLnNlYXJjaFJlcXVlc3RTZXF1ZW5jZXIuY29tcGxldGVkKHJlcXVlc3RJZCk7XG5cbiAgICAgICAgICAvLyBSZXN1bHRzIHBhZ2luZyBzdGFydCAmIGVuZFxuICAgICAgICAgIGNvbnN0IHsgdG90YWxSZXN1bHRzIH0gPSByZXN1bHRTdGF0ZTtcbiAgICAgICAgICBjb25zdCBzdGFydCA9XG4gICAgICAgICAgICB0b3RhbFJlc3VsdHMgPT09IDAgPyAwIDogKGN1cnJlbnQgLSAxKSAqIHJlc3VsdHNQZXJQYWdlICsgMTtcbiAgICAgICAgICBjb25zdCBlbmQgPVxuICAgICAgICAgICAgdG90YWxSZXN1bHRzIDw9IHN0YXJ0ICsgcmVzdWx0c1BlclBhZ2VcbiAgICAgICAgICAgICAgPyB0b3RhbFJlc3VsdHNcbiAgICAgICAgICAgICAgOiBzdGFydCArIHJlc3VsdHNQZXJQYWdlIC0gMTtcblxuICAgICAgICAgIHRoaXMuX3NldFN0YXRlKHtcbiAgICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICByZXN1bHRTZWFyY2hUZXJtOiBzZWFyY2hUZXJtLFxuICAgICAgICAgICAgcGFnaW5nU3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgICAgcGFnaW5nRW5kOiBlbmQsXG4gICAgICAgICAgICAuLi5yZXN1bHRTdGF0ZSxcbiAgICAgICAgICAgIHdhc1NlYXJjaGVkOiB0cnVlXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAodGhpcy5oYXNBMTF5Tm90aWZpY2F0aW9ucykge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZUFyZ3MgPSB7IHN0YXJ0LCBlbmQsIHRvdGFsUmVzdWx0cywgc2VhcmNoVGVybSB9O1xuICAgICAgICAgICAgdGhpcy5hY3Rpb25zLmExMXlOb3RpZnkoXCJzZWFyY2hSZXN1bHRzXCIsIG1lc3NhZ2VBcmdzKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIXNraXBQdXNoVG9VcmwgJiYgdGhpcy50cmFja1VybFN0YXRlKSB7XG4gICAgICAgICAgICAvLyBXZSBkZWJvdW5jZSBoZXJlIHNvIHRoYXQgd2UgZG9uJ3QgZ2V0IGEgbG90IG9mIGludGVybWVkaWFyeVxuICAgICAgICAgICAgLy8gVVJMIHN0YXRlIGlmIHNvbWVvbmUgaXMgdXBkYXRpbmcgYSBVSSByZWFsbHkgZmFzdCwgbGlrZSB0eXBpbmdcbiAgICAgICAgICAgIC8vIGluIGEgbGl2ZSBzZWFyY2ggYm94IGZvciBpbnN0YW5jZS5cbiAgICAgICAgICAgIHRoaXMuZGVib3VuY2VNYW5hZ2VyLnJ1bldpdGhEZWJvdW5jZShcbiAgICAgICAgICAgICAgdGhpcy51cmxQdXNoRGVib3VuY2VMZW5ndGgsXG4gICAgICAgICAgICAgIFwicHVzaFN0YXRlVG9VUkxcIixcbiAgICAgICAgICAgICAgdGhpcy5VUkxNYW5hZ2VyLnB1c2hTdGF0ZVRvVVJMLmJpbmQodGhpcy5VUkxNYW5hZ2VyKSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGN1cnJlbnQsXG4gICAgICAgICAgICAgICAgZmlsdGVycyxcbiAgICAgICAgICAgICAgICByZXN1bHRzUGVyUGFnZSxcbiAgICAgICAgICAgICAgICBzZWFyY2hUZXJtLFxuICAgICAgICAgICAgICAgIHNvcnREaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgc29ydEZpZWxkXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHsgcmVwbGFjZVVybCB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgIHRoaXMuX3NldFN0YXRlKHtcbiAgICAgICAgICAgIGVycm9yOiBgQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZDogJHtlcnJvci5tZXNzYWdlfWBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9XG4gICk7XG5cbiAgX3NldFN0YXRlKG5ld1N0YXRlKSB7XG4gICAgY29uc3Qgc3RhdGUgPSB7IC4uLnRoaXMuc3RhdGUsIC4uLm5ld1N0YXRlIH07XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICBpZiAodGhpcy5kZWJ1ZykgY29uc29sZS5sb2coXCJTZWFyY2ggVUk6IFN0YXRlIFVwZGF0ZVwiLCBuZXdTdGF0ZSwgc3RhdGUpO1xuICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZm9yRWFjaChzdWJzY3JpcHRpb24gPT4gc3Vic2NyaXB0aW9uKHN0YXRlKSk7XG4gIH1cblxuICAvKipcbiAgICogRHluYW1pY2FsbHkgdXBkYXRlIHRoZSBzZWFyY2hRdWVyeSBjb25maWd1cmF0aW9uIGluIHRoaXMgZHJpdmVyLlxuICAgKiBUaGlzIHdpbGwgaXNzdWUgYSBuZXcgcXVlcnkgYWZ0ZXIgYmVpbmcgdXBkYXRlZC5cbiAgICpcbiAgICogQHBhcmFtIE9iamVjdCBzZWFyY2hRdWVyeVxuICAgKi9cbiAgc2V0U2VhcmNoUXVlcnkoc2VhcmNoUXVlcnkpIHtcbiAgICB0aGlzLnNlYXJjaFF1ZXJ5ID0gc2VhcmNoUXVlcnk7XG4gICAgdGhpcy5fdXBkYXRlU2VhcmNoUmVzdWx0cygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSBPYmplY3QgYXV0b2NvbXBsZXRlUXVlcnlcbiAgICovXG4gIHNldEF1dG9jb21wbGV0ZVF1ZXJ5KGF1dG9jb21wbGV0ZVF1ZXJ5KSB7XG4gICAgdGhpcy5hdXRvY29tcGxldGVRdWVyeSA9IGF1dG9jb21wbGV0ZVF1ZXJ5O1xuICB9XG5cbiAgLyoqXG4gICAqIEFueSB0aW1lIHN0YXRlIGlzIHVwZGF0ZWQgaW4gdGhpcyBEcml2ZXIsIHRoZSBwcm92aWRlZCBjYWxsYmFja1xuICAgKiB3aWxsIGJlIGV4ZWN1dGVkIHdpdGggdGhlIHVwZGF0ZWQgc3RhdGUuXG4gICAqXG4gICAqIEBwYXJhbSBvblN0YXRlQ2hhbmdlIEZ1bmN0aW9uXG4gICAqL1xuICBzdWJzY3JpYmVUb1N0YXRlQ2hhbmdlcyhvblN0YXRlQ2hhbmdlKSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2gob25TdGF0ZUNoYW5nZSk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIG9uU3RhdGVDaGFuZ2UgRnVuY3Rpb25cbiAgICovXG4gIHVuc3Vic2NyaWJlVG9TdGF0ZUNoYW5nZXMob25TdGF0ZUNoYW5nZSkge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IHRoaXMuc3Vic2NyaXB0aW9ucy5maWx0ZXIoXG4gICAgICBzdWIgPT4gc3ViICE9PSBvblN0YXRlQ2hhbmdlXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYWxsIGxpc3RlbmVyc1xuICAgKi9cbiAgdGVhckRvd24oKSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zID0gW107XG4gICAgdGhpcy5VUkxNYW5hZ2VyICYmIHRoaXMuVVJMTWFuYWdlci50ZWFyRG93bigpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhbGwgYXZhaWxhYmxlIGFjaXRvbnNcbiAgICpcbiAgICogQHJldHVybnMgT2JqZWN0IEFsbCBhY3Rpb25zXG4gICAqL1xuICBnZXRBY3Rpb25zKCkge1xuICAgIHJldHVybiB0aGlzLmFjdGlvbnM7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgY3VycmVudCBzdGF0ZS4gVHlwaWNhbGx5IHVzZWQgb24gYXBwIGluaXRpYWxpemF0aW9uLiBTdWJzZXF1ZW50XG4gICAqIHN0YXRlIHVwZGF0ZXMgc2hvdWxkIGNvbWUgdGhyb3VnaCBzdWJzY3JpcHRpb24uXG4gICAqXG4gICAqIEByZXR1cm5zIE9iamVjdCBDdXJyZW50IHN0YXRlXG4gICAqL1xuICBnZXRTdGF0ZSgpIHtcbiAgICAvLyBXZSByZXR1cm4gYSBjb3B5IG9mIHN0YXRlIGhlcmUsIGJlY2F1c2Ugd2Ugd2FudCB0byBlbnN1cmUgdGhlIHN0YXRlXG4gICAgLy8gaW5zaWRlIG9mIHRoaXMgb2JqZWN0IHJlbWFpbnMgaW1tdXRhYmxlLlxuICAgIHJldHVybiB7IC4uLnRoaXMuc3RhdGUgfTtcbiAgfVxufVxuIl19